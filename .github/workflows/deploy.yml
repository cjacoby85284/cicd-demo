# ─────────────────────────────────────────────────────────────────────────────
# deploy.yml  —  CI/CD pipeline for cicd-demo
#
# WHAT THIS DOES:
#   Every time you push code to the "main" branch, GitHub automatically runs
#   this workflow. It checks out your code and deploys it to Cloudflare Pages.
#
# KEY CONCEPTS:
#   - "workflow"  = the whole automation file (this file)
#   - "job"       = a group of steps that run on one virtual machine
#   - "step"      = one individual task inside a job
#   - "action"    = a pre-built, reusable step from the GitHub marketplace
#   - "secret"    = an encrypted variable stored in GitHub (never visible in logs)
# ─────────────────────────────────────────────────────────────────────────────

name: Deploy to Cloudflare Pages (DEV)

# ── TRIGGER ──────────────────────────────────────────────────────────────────
# This section says WHEN to run the workflow.
# "push" means: run this whenever someone pushes commits.
# "branches: [main]" means: only care about pushes to the "main" branch.
on:
    push:
        branches:
            - main

# ── JOBS ─────────────────────────────────────────────────────────────────────
# A workflow can have multiple jobs. Ours has just one: "deploy".
jobs:
    deploy:
        name: Deploy
        # This means: spin up a fresh Ubuntu Linux virtual machine to run our steps.
        runs-on: ubuntu-latest

        # ── STEPS ──────────────────────────────────────────────────────────────
        # Steps run in order, top to bottom. If any step fails, the job stops.
        steps:
            # STEP 1: Checkout
            # "actions/checkout" is an official GitHub Action that clones your repo
            # onto the virtual machine so the next steps can see your files.
            - name: Checkout code
              uses: actions/checkout@v4

            # STEP 2: Deploy to Cloudflare Pages
            # "cloudflare/wrangler-action" is Cloudflare's official GitHub Action.
            # It installs wrangler (Cloudflare's CLI tool) and runs a deploy command.
            #
            # "secrets.*" pulls in the encrypted values you saved in GitHub Settings.
            # They are NEVER printed in logs — GitHub automatically redacts them.
            - name: Deploy to Cloudflare Pages
              uses: cloudflare/wrangler-action@v3
              with:
                  apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
                  accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
                  # "wrangler pages deploy" uploads the files to Cloudflare Pages.
                  # "."  means "deploy everything in the current directory"
                  # "--project-name" tells Cloudflare which Pages project to deploy to
                  # "--branch=main" tells Cloudflare this is the production (DEV) branch
                  command: pages deploy . --project-name=cicd-demo --branch=main
